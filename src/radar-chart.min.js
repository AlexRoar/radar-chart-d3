var RadarChart={defaultConfig:{containerClass:"radar-chart",w:600,h:600,factor:.95,factorLegend:1,levels:3,levelTick:!1,TickLength:10,maxValue:0,minValue:0,changeable:!1,radians:2*Math.PI,color:d3.scale.category10(),axisLine:!0,axisText:!0,circles:!0,radius:5,backgroundTooltipColor:"#555",backgroundTooltipOpacity:"0.7",tooltipColor:"white",onMove:function(t,e){},axisJoin:function(t,e){return t.className||e},tooltipFormatValue:function(t){return t},tooltipFormatClass:function(t){return t},transitionDuration:300},chart:function(){const t=Object.create(RadarChart.defaultConfig);function e(e,a){if(0==a||null==a)e.classed("visible",0),e.select("rect").classed("visible",0);else{e.classed("visible",1);var n=e.node().parentNode,r=d3.mouse(n);e.select("text").classed("visible",1).style("fill",t.tooltipColor);var o=e.select("text").text(a).node().getBBox();e.select("rect").classed("visible",1).attr("x",0).attr("x",o.x-10).attr("y",o.y-10).attr("width",o.width+20).attr("height",o.height+20).attr("rx","5").attr("ry","5").style("fill",t.backgroundTooltipColor).style("opacity",t.backgroundTooltipOpacity),e.attr("transform","translate("+(r[0]+30)+","+(r[1]-30)+")")}}function a(t,e,a){return t>a?a:t<e?e:t}function n(n){n.each(function(n){var r=d3.select(this),o=r.selectAll("g.tooltip").data([n[0]]),s=o.enter().append("g").classed("tooltip",!0);s.append("rect").classed("tooltip",!0),s.append("text").classed("tooltip",!0),n=n.map(function(t){return t instanceof Array&&(t={axes:t}),t});var c=Math.max(t.maxValue,d3.max(n,function(t){return d3.max(t.axes,function(t){return t.value})}));c-=t.minValue;var l=n[0].axes.map(function(t,e){return{name:t.axis,xOffset:t.xOffset?t.xOffset:0,yOffset:t.yOffset?t.yOffset:0}}),u=l.length,d=t.factor*Math.min(t.w/2,t.h/2),f=Math.min(t.w/2,t.h/2);function p(e,a,n,r){return a*(1-(n=void 0!==n?n:1)*r(e*t.radians/u))}function h(t,e,a){return p(t,e,a,Math.sin)}function x(t,e,a){return p(t,e,a,Math.cos)}r.classed(t.containerClass,1);var v=d3.range(0,t.levels).map(function(e){return d*((e+1)/t.levels)}),g=r.selectAll("g.level-group").data(v);g.enter().append("g"),g.exit().remove(),g.attr("class",function(t,e){return"level-group level-group-"+e});var m=g.selectAll(".level").data(function(t){return d3.range(0,u).map(function(){return t})});if(m.enter().append("line"),m.exit().remove(),t.levelTick?m.attr("class","level").attr("x1",function(e,a){return d==e?h(a,e):h(a,e)+t.TickLength/2*Math.cos(a*t.radians/u)}).attr("y1",function(e,a){return d==e?x(a,e):x(a,e)-t.TickLength/2*Math.sin(a*t.radians/u)}).attr("x2",function(e,a){return d==e?h(a+1,e):h(a,e)-t.TickLength/2*Math.cos(a*t.radians/u)}).attr("y2",function(e,a){return d==e?x(a+1,e):x(a,e)+t.TickLength/2*Math.sin(a*t.radians/u)}).attr("transform",function(e){return"translate("+(t.w/2-e)+", "+(t.h/2-e)+")"}):m.attr("class","level").attr("x1",function(t,e){return h(e,t)}).attr("y1",function(t,e){return x(e,t)}).attr("x2",function(t,e){return h(e+1,t)}).attr("y2",function(t,e){return x(e+1,t)}).attr("transform",function(e){return"translate("+(t.w/2-e)+", "+(t.h/2-e)+")"}),t.axisLine||t.axisText){var y=r.selectAll(".axis").data(l),w=y.enter().append("g");t.axisLine&&w.append("line"),t.axisText&&w.append("text"),y.exit().remove(),y.attr("class","axis"),t.axisLine&&y.select("line").attr("x1",t.w/2).attr("y1",t.h/2).attr("x2",function(e,a){return t.w/2-f+h(a,f,t.factor)}).attr("y2",function(e,a){return t.h/2-f+x(a,f,t.factor)}),t.axisText&&y.select("text").attr("class",function(t,e){var a=h(e,.5);return"legend "+(a<.4?"left":a>.6?"right":"middle")}).attr("dy",function(t,e){var a=x(e,.5);return a<.1?"1em":a>.9?"0":"0.5em"}).text(function(t){return t.name}).attr("x",function(e,a){return e.xOffset+(t.w/2-f)+h(a,f,t.factorLegend)}).attr("y",function(e,a){return e.yOffset+(t.h/2-f)+x(a,f,t.factorLegend)})}n.forEach(function(e){e.axes.forEach(function(e,a){e.x=t.w/2-f+h(a,f,parseFloat(Math.max(e.value-t.minValue,0))/c*t.factor),e.y=t.h/2-f+x(a,f,parseFloat(Math.max(e.value-t.minValue,0))/c*t.factor)})});var C=r.selectAll(".area").data(n,t.axisJoin);if(C.enter().append("polygon").classed({area:1,"d3-enter":1}).on("mouseover",function(a){d3.event.stopPropagation(),r.classed("focus",1),d3.select(this).classed("focused",1),e(o,t.tooltipFormatClass(a.className))}).on("mouseout",function(){d3.event.stopPropagation(),r.classed("focus",0),d3.select(this).classed("focused",0),e(o,!1)}),C.exit().classed("d3-exit",1).transition().duration(t.transitionDuration).remove(),C.each(function(t,e){var a={"d3-exit":0};a["radar-chart-serie"+e]=1,t.className&&(a[t.className]=1),d3.select(this).classed(a)}).style("stroke",function(e,a){return t.color(a)}).style("fill",function(e,a){return t.color(a)}).transition().duration(t.transitionDuration).attr("points",function(t){return t.axes.map(function(t){return[t.x,t.y].join(",")}).join(" ")}).each("start",function(){d3.select(this).classed("d3-enter",0)}),t.circles&&t.radius){var M=r.selectAll("g.circle-group").data(n,t.axisJoin);M.enter().append("g").classed({"circle-group":1,"d3-enter":1}),M.exit().classed("d3-exit",1).transition().duration(t.transitionDuration).remove(),M.each(function(t){var e={"d3-exit":0};t.className&&(e[t.className]=1),d3.select(this).classed(e)}).transition().duration(t.transitionDuration).each("start",function(){d3.select(this).classed("d3-enter",0)});var T=M.selectAll(".circle").data(function(t,e){return t.axes.map(function(t){return[t,e]})});T.enter().append("circle").classed({circle:1,"d3-enter":1}).on("mouseover",function(a){d3.event.stopPropagation(),e(o,t.tooltipFormatValue(a[0].value))}).on("mouseout",function(t){d3.event.stopPropagation(),e(o,!1),r.classed("focus",0)}),T.exit().classed("d3-exit",1).transition().duration(t.transitionDuration).remove(),T.each(function(t){var e={"d3-exit":0};e["radar-chart-serie"+t[1]]=1,d3.select(this).classed(e)}).style("fill",function(e){return t.color(e[1])}).transition().duration(t.transitionDuration).attr("r",t.radius).attr("cx",function(t){return t[0].x}).attr("cy",function(t){return t[0].y}).each("start",function(){d3.select(this).classed("d3-enter",0)}),t.changeable&&T.call(d3.behavior.drag().on("drag",function(r,i){const s=d3.select(this),c=t.w/2,l=t.h/2,u=t.maxValue,d=parseFloat(s.attr("cx"))-c,f=l-parseFloat(s.attr("cy"));let p=0,h=0;const x=n[0].axes.length;let v=l,g=c,m=1e-4,y=1e-4;if(i<x/2){const t=y;y=-g,g=-t}if(i>x/4&&i<x/4*3){const t=m;m=-v,v=-t}if(0===i||i===x/2)p=a(f-d3.event.dy,m,v);else{const t=f/d;h=a(d+d3.event.dx,y,g),((p=h*t)<m||p>v)&&(p=f,h=d)}let w=Math.sqrt(h*h+p*p)/(t.factor*c)*u;w>u&&(p=f,h=d),h+=c,p=l-p,s.attr("cx",function(){return h}).attr("cy",function(){return p}),n[0].axes[i].value=w;const M=C.attr("points").split(" ");M[i]=h.toString(10)+","+p.toString(10),C.attr("points",M.join(" ")),e(o,t.tooltipFormatValue(w))}));var b=C.node();b.parentNode.appendChild(b);var k=M.node();k.parentNode.appendChild(k);var L=o.node();L.parentNode.appendChild(L),t.onMove(dobj,i)}})}return n.config=function(e){return arguments.length?(arguments.length>1?t[arguments[0]]=arguments[1]:d3.entries(e||{}).forEach(function(e){t[e.key]=e.value}),n):t},n},draw:function(t,e,a){a.data=e;const n=RadarChart.chart().config(a),r=n.config();d3.select(t).select("svg").remove(),d3.select(t).append("svg").attr("width",r.w).attr("height",r.h).datum(e).call(n)}};
